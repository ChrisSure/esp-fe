<div class="dashboard-container">
  <mat-card class="recording-card">
    <mat-card-content>
      <div class="recording-controls">
        <button
          mat-fab
          color="primary"
          class="record-button"
          [disabled]="isRecording"
          (click)="startRecording()"
          [class.recording]="isRecording"
        >
          <mat-icon>{{ isRecording ? 'mic' : 'mic_none' }}</mat-icon>
        </button>

        <button
          mat-fab
          color="warn"
          class="stop-button"
          [disabled]="!isRecording"
          (click)="stopRecording()"
        >
          <mat-icon>stop</mat-icon>
        </button>
      </div>

      <div class="recording-status">
        <p *ngIf="isRecording" class="recording-text">
          <mat-icon class="pulse">fiber_manual_record</mat-icon>
          Recording in progress...
        </p>
        <p *ngIf="!isRecording && !audioUrl" class="idle-text">
          Click the microphone button to start recording
        </p>
        <p *ngIf="!isRecording && audioUrl" class="completed-text">
          <mat-icon>check_circle</mat-icon>
          Recording completed
        </p>
      </div>

      <!-- Playback Controls (shown when recording exists) -->
      <div class="playback-controls" *ngIf="audioUrl && !isRecording">
        <div class="playback-buttons">
          <button mat-raised-button color="primary" (click)="playRecording()">
            <mat-icon>play_arrow</mat-icon>
            Play
          </button>

          <button mat-raised-button color="accent" (click)="downloadRecording()">
            <mat-icon>download</mat-icon>
            Download
          </button>

          <button
            mat-raised-button
            color="warn"
            [disabled]="isTranscribing"
            (click)="transcribeAudio()"
          >
            <mat-icon *ngIf="!isTranscribing">transcribe</mat-icon>
            <mat-spinner *ngIf="isTranscribing" diameter="20"></mat-spinner>
            {{ isTranscribing ? 'Transcribing...' : 'Transcribe' }}
          </button>

          <button mat-raised-button (click)="clearRecording()">
            <mat-icon>delete</mat-icon>
            Clear
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Transcription Results Card -->
  <mat-card
    class="transcription-card"
    *ngIf="transcriptionResult || transcriptionError || isTranscribing"
  >
    <mat-card-header>
      <mat-card-title>
        <mat-icon>text_snippet</mat-icon>
        Transcription Result
      </mat-card-title>
      <mat-card-subtitle *ngIf="lastTranscriptionTime">
        Generated on {{ lastTranscriptionTime | date: 'short' }}
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Loading State -->
      <div *ngIf="isTranscribing" class="transcription-loading">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Processing audio transcription...</p>
        <small>This may take a few moments depending on the audio length.</small>
      </div>

      <!-- Success State -->
      <div *ngIf="transcriptionResult && !isTranscribing" class="transcription-result">
        <div class="transcription-text">
          <p>{{ transcriptionResult }}</p>
        </div>

        <mat-divider></mat-divider>

        <div class="transcription-actions">
          <button mat-raised-button color="primary" (click)="copyTranscription()">
            <mat-icon>content_copy</mat-icon>
            Copy
          </button>

          <button mat-raised-button (click)="clearTranscription()">
            <mat-icon>clear</mat-icon>
            Clear
          </button>
        </div>
      </div>

      <!-- Error State -->
      <div *ngIf="transcriptionError && !isTranscribing" class="transcription-error">
        <mat-icon color="warn">error_outline</mat-icon>
        <div class="error-content">
          <h4>Transcription Failed</h4>
          <p>{{ transcriptionError }}</p>
          <button mat-raised-button color="primary" (click)="transcribeAudio()">
            <mat-icon>refresh</mat-icon>
            Try Again
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
